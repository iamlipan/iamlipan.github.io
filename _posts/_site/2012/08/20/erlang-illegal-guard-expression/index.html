<p>今天遇到一个奇怪的问题：</p>

<pre class="erlang">put(a, 1),
if
	get(a) =:= 1 -&gt;
		ok;
	true -&gt;
		bad
end.

* 2: illegal guard expression</pre>

<p>查了一下官方关于Guard的文档：<br />
The set of valid guard expressions (sometimes called guard tests) is a subset of the set of valid Erlang expressions. The reason for restricting the set of valid expressions is that evaluation of a guard expression must be guaranteed to be free of side effects.</p>

<p>网上也有人问道：</p>
<blockquote>

  <p>On Fri, Dec 2, 2011 at 10:30 AM, Barco You &lt;&gt; wrote:<br />
Why does the following expression got “illegal guard expression” when compiling:<br />
X = 0.5,<br />
if<br />
random:uniform() &lt; X -&gt; %error reported for this line<br />
good;<br />
true -&gt;<br />
bad<br />
end.</p>

  <p>But if I change it to following expression, it’s ok:<br />
X = 0.5,<br />
Ran = random:uniform(),<br />
if<br />
Ran &lt; X -&gt;<br />
good;<br />
true -&gt;<br />
bad<br />
end.<br />
Yes, and not only does this mean that only a limited set of functions are allowed as guard functions, random:uniform() _does_ have side effects, since it updates the seed in the process dictionary.</p>
</blockquote>

<p>可见，erlang:get/1 also has side effect.</p>
